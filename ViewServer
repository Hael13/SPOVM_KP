// ViewServer.cpp: файл реализации
//

#include "stdafx.h"
#include "ViewServer.h"


// диалоговое окно ViewServer

IMPLEMENT_DYNAMIC(ViewServer, CDialog)

ViewServer::ViewServer(CWnd* pParent /*=NULL*/): CDialog(IDD_DIALOG1, pParent)
{
	this->DoModal();
}

ViewServer::~ViewServer()
{
}

void ViewServer::DoDataExchange(CDataExchange* pDX)
{
	CDialog::DoDataExchange(pDX);
	DDX_Control(pDX, IDC_EDIT1, text_field);
	DDX_Control(pDX, IDC_UPLOAD, upload);
	DDX_Control(pDX, IDC_DELETE, del);
	DDX_Control(pDX, IDC_FILE_LIST, listbox);
	char *name;
	for (int i = 0; (name = this->server.filename(i)) != nullptr; i++)
	{
		this->listbox.AddString(name);
	}
	this->UpdateWindow();
}


BEGIN_MESSAGE_MAP(ViewServer, CDialog)
	ON_BN_CLICKED(IDC_UPLOAD, &ViewServer::OnBnClickedUpload)
	ON_BN_CLICKED(IDC_DELETE, &ViewServer::OnBnClickedDelete)
END_MESSAGE_MAP()

// обработчики сообщений ViewServer

void ViewServer::OnBnClickedUpload()
{
	char buf[256];
	int size;
	size = this->text_field.GetLine(0, buf);
	buf[size] = '\0';
	if (this->server.add(buf))
	{
		this->listbox.AddString(buf);
	}
}


void ViewServer::OnBnClickedDelete()
{
	int i;
	i = this->listbox.GetCurSel();
	this->server.delete_file(i);
	this->listbox.DeleteString(i);
}
